<%
  members_html = "
We have #{@total_members} members worldwide, you can see them all on <a href='/members'>the member list</a>.
<ul class='thumbnails'>"
  @members.each do |m|
    if m.avatar
      # note: gets processed by markdown so can't have leading spaces
      members_html += "
<li class='span1'>
#{link_to image_tag(m.avatar.url(:small)),"/members/#{m.slug}", :class=>"thumbnail"}
</li>"
    end
  end
  members_html += "
</ul>"
%>

<%
  careers_html = "
We have done research into some of the best careers for effective altruists.
<ul class='thumbnails'>"
  @careers.each do |c|
    # note: gets processed by markdown so can't have leading spaces
    careers_html += "
<li class='span1'>
#{link_to image_tag( "career_icons/#{c}.jpg", :alt=>"#{c.humanize}"),"/career-profiles##{c.gsub(/_/,'-')}", :class => 'thumbnail'}
</li>"
  end
  careers_html += "
</ul>"
%>

<%
  posts = Post.published.limit(3)
  latest_blog_html = "<h3>Latest posts</h3>"
  posts.each do |post|
    # note: gets processed by markdown so can't have leading spaces
    latest_blog_html += "
<div class='blog-latest'>
<a class='title' href='#{post_path post}'>#{post.title}</a>
<br/>
#{(render :partial => 'posts/author_link', :locals => { :post => post })}
</div>
"
  end
%>

<%
  comments = Comment.order("created_at DESC").limit(3)
  latest_blog_html += "<h3>Latest comments</h3>"
  comments.each do |comment|
    latest_blog_html += "
<div class='blog-latest-comment'>
<a class='title' href='#{post_path comment.post}#comments'>#{comment.post.title}</a>
<br/>
<span class='author'>#{comment.user.name}</span>
<span class='date'>#{comment.created_at.strftime("%B %d, %Y")}</span>
</div>
"
  end
%>

<% content = @page.body %>
<% content = content.gsub(/\|\*MEMBERS\*\|/, members_html) %>
<% content = content.gsub(/\|\*CAREERS\*\|/, careers_html) %>
<% content = content.gsub(/\|\*LATEST_BLOG\*\|/, latest_blog_html) %>
<%= markdown content %>

